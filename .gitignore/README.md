# -AI--
大航杯“智造扬中”电力AI大赛-金陵书生
摘要：maxCompte平台支持的日期格式通常是对齐的日期格式诸如20170725或2017/07/25这种，而本次电力AI赛提供的日期格式确实未对齐的非标准（相对maxCompute平台来说）的日期格式2016/1/1这种，使得无法直接使用ODPS SQL中的日期函数来进行处理。同时，电力AI赛提供的气象数据并不是已经数值化的数据，也使得很多团队未能将气象数据利用起来（现已公开解决方案的团队，基本上天气数据中的气象、风速和风向信息等都未使用），而气象数据通常来说对短期负荷预测具有较大的影响。本文将详细介绍利用maxCompute的ODPS SQL处理电力AI赛的非标准日期数据的方法和利用OPEN_MR来处理天气数据的详细方法，并给出复赛Rank 20 团队的详细解决方案，欢迎各位批评指正。

由于在参加电力AI赛的过程中受到了一些干扰，因此中间很长时间都转去处理其他事情了，直到复赛换数据后的最后2天才重试比赛。除了气象部分的数据之前抽了2天时间来处理外，其他代码都是在复赛换数据后的2天内临时赶出来的，因此不管是特征工程还是想做的先对用户分类再分别预测的工作都没来得及做完，同时，为了加快开发效率，这里没有使用机器学习平台，全部模型都通过PAI命令集成到ODPS SQL脚本中，实现批量运行。实际上，处理OPEN_MR部分由于目前无法集成到ODPS SQL所以需要中断一次，其他的代码可以点击一次运行就批量运行完成，直接完成从原始数据到提交结果的全过程。

一、 赛题说明

本次竞赛主要数据源为企业用电量表Tianchi_power，抽取了扬中市高新区的1000多家企业的用电量（数据进行了脱敏），包括企业ID（匿名化处理），日期和用电量。具体字段如下表：

tianchi_power

列名

类型

含义

示例

record_date

string

日期

20150101

user_id

bigint

企业id

1

power_consumption

bigint

用电量

1031

...	...	...	...
气象数据表为tianchi_weather_data，起内容如下表所示：

weather

选手提交结果表 

tianchi_power_answer

列名

类型

含义

示例

predict_date

string

日期

2016/9/1

power_consumption

bigint

预测的用电量

1031



二、赛题解读

这是一个短期负荷预测（short-term load forecasting）问题，国家电网于2010年曾出台过 国家电网企业标准 Q/GDW 552-2010 《电网短期超短期负荷预测技术规范》，在规范中对相关的术语、预测内容、误差计算公式、常用的预测算法等都做了介绍。在本次比赛中，由于负荷预测的用途不一样，因此并未完全遵守国家电网的企业标准中规定的预测内容（时间粒度和待预测时长），并且预测误差评价公式也采用了自定义的公式，但问题的本质并未改变，仍然是一个短期负荷预测问题。

我们在前期做光伏电站超短期发电功率预测时，发现缺失值和数值天气预报数据对预测精度的影响最大，并且国网的企业标准中对负荷预测的影响因素也有个大致的介绍：

国网负荷预测影响因素

由于社会事件等不可知，因此本次比赛中我们侧重解决缺失值和气象数据的问题，将主要工作集中在三个地方：

1）对官方给定的气象数据进行编码、变换等，构建完善的气象数据特征；

2）构建过拟合的模型来填充缺失值；

3）用修订数据构建模型一来预测趋势，原始数据构建模型二来预测用电量水平（大致值），再对两个模型进行加权融合；
